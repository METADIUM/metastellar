{"version":3,"file":"4.e322c37d6c267560dee4.hot-update.js","sources":["webpack:///pages/user.js"],"sourcesContent":["import React, {Component} from 'react';\nimport metaStellar from '../ethereum/metaStellar.js';\nimport web3 from '../ethereum/web3.js';\nimport {BigNumber} from 'bignumber.js';\nimport {Layout, Astro, MetaID, AstroList} from '../components/index';\nimport LayoutHeader from '../components/Header';\nimport Alert from 'react-s-alert';\nimport {Button} from 'semantic-ui-react';\n\nexport default class User extends Component {\n\n  static async getInitialProps({ query: { address } }) {\n    const bucketLength = await metaStellar.methods.getBucketLength(address).call();\n    const starIndexes = Array.from(Array(parseInt(bucketLength))).map((e,i)=>i);\n    var pages = [], per_pages = 18\n    while (starIndexes.length > 0) {\n      pages.push(starIndexes.splice(0, per_pages));\n    }\n\n    const initProps = {\n      address: address,\n      pages: pages\n    };\n\n    return initProps || {};\n  }\n\n  constructor() {\n    super();\n    this.state = {\n      astros: [],\n      page: 0,\n      no_more: false,\n      loading: true,\n      metaID: {\n        name: '',\n        sns: '',\n        owner: ''\n      }\n    }\n  }\n\n  componentDidMount() {\n    this.paginateChain()\n    .then(() => this.setState({ loading: false, page: this.state.page + 1 }));\n\n    if (!(typeof window !== 'undefined' && typeof window.web3 !== 'undefined')) {\n      Alert.info('<h4>Metamask not available.</h4><ul><li><a href=\"https://metamask.io/\" target=\"_blank\">Get Metamask now.</a></li></ul>', {\n        position: 'top-right',\n        effect: 'slide',\n        html: true,\n        timeout: 5000\n      });\n    } else {\n      web3.eth.net.getNetworkType()\n          .then((network) => {\n            if (network !== 'ropsten') {\n              Alert.info('<h4>You are not in a ropsten network.</h4><ul><li><a href=\"https://metamask.io/\" target=\"_blank\">Open Metamask and change your network to ropsten.</a></li></ul>', {\n                position: 'top-right',\n                effect: 'slide',\n                html: true,\n                timeout: 5000\n              });\n            }\n          });\n    }\n  }\n\n  onClickPagination() {\n    this.setState({ loading: true }, () => {\n      this.paginateChain()\n      .then(() => this.setState({ loading: false, page: this.state.page + 1 }));\n    })\n  }\n\n  async paginateChain() {\n    await this.generatePromises(this.state.page).then(async (promises) => {\n      console.log(promises.length);\n      if (promises.length < 18) {\n        await this.setState({ no_more: true });\n      }\n      for (const promise of promises) {\n        try {\n          var astro = await promise;\n          this.setState({\n            astros: [...this.state.astros, astro]\n          })\n          if (this.state.metaID.name === '') {\n            this.setState({metaID: astro.metaID})\n          }\n        } catch (error) {\n          console.log(error, 'error');\n        }\n      }\n    })\n  }\n\n  async generatePromises(page) {\n    const minimumPrice = await metaStellar.methods.minimumPrice().call();\n\n    let promises = this.props.pages[page].map(async (idx) => {\n      const astroId = await metaStellar.methods.astroBucket(this.props.address, idx).call();\n      const rawAstro = await metaStellar.methods.getAstro(astroId).call();\n      const lastBid = await new BigNumber(parseInt(rawAstro.lastBid));\n      const minBidTic = await new BigNumber(parseInt(minimumPrice));\n      const currentBid = await lastBid.plus(minBidTic);\n      \n      return {\n        id: parseInt(rawAstro.id),\n        target: {name: rawAstro.name},\n        ra: {decimal: (rawAstro.raDecimal / 1000)},\n        dec: {decimal: (rawAstro.decDecimal / 1000)},\n        metaID: {\n          name: rawAstro.metaIDName,\n          owner: rawAstro.metaIDOwner,\n          sns: rawAstro.metaIDSns\n        },\n        lastBid: lastBid,\n        minBidTic: minBidTic,\n        currentBid: currentBid\n      }\n    });\n\n    return promises;\n  }\n\n  render() {\n    return (\n        <Layout fluid style={{margin: '5vw'}}>\n          <LayoutHeader>\n            <h3>{`${this.state.metaID}`}<a href={`https:${this.state.metaID.sns}`} target={'_blank'}>{`${this.state.metaID.name}'s space`}</a> | <a href={`https://ropsten.etherscan.io/address/${this.state.metaID.owner}`} target={'_blank'}>Address</a></h3>\n          </LayoutHeader>\n          <AstroList astros={this.state.astros}/>\n          {this.state.no_more ?\n          null : <Button fluid basic loading={this.state.loading} style={{ marginTop: '10px', marginBottom: '10px'}} onClick={() => this.onClickPagination()}>\n          Next Page\n        </Button>}\n          <Alert stack={{limit: 3}} />\n        </Layout>\n    )\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// pages/user.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;AAEA;;AACA;AACA;;AADA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAKA;AACA;;;;;;;;;;;;;;;AAEA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AALA;AAFA;AAaA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAGA;AAAA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AALA;AAAA;AAAA;AACA;AADA;AAOA;AACA;AAAA;AACA;AADA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AAdA;AAAA;AACA;AADA;AAAA;AAAA;AAeA;AACA;AAhBA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;;AAoBA;;;;;;;;;AACA;AACA;;AADA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AACA;AADA;AAEA;AAFA;AAAA;AACA;AADA;AAGA;AAHA;AAAA;AACA;AADA;AAIA;AAJA;AAAA;AACA;AADA;AAKA;AALA;AAQA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAZA;AACA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAuBA;AACA;;;;;;;;;;;;;;;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;;;;;;;;;;;AAnIA;AACA;AADA;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}